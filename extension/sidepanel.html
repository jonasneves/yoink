<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="colors.css">
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="header">
    <div class="header-left">
      <div class="header-icon">
        <img src="icon-48.png" alt="CanvasFlow" style="width: 35px; height: 35px;">
      </div>
      <h1 class="title">CanvasFlow</h1>
    </div>
    <div class="header-right">
      <button class="btn-icon" id="focusModeBtn" title="Focus Mode: Show only top 3 priorities">
        <i data-lucide="target"></i>
      </button>
      <button class="btn-icon" id="openDashboardBtn" title="Open weekly schedule">
        <i data-lucide="calendar"></i>
      </button>
      <button class="btn-icon" id="settingsBtn" title="Settings">
        <i data-lucide="settings"></i>
      </button>
    </div>
  </div>

  <div class="tab-nav">
    <button class="tab-button active" data-tab="canvas-data">Dashboard</button>
    <button class="tab-button" data-tab="ai-dashboard">Study Planner</button>
  </div>

  <!-- Canvas URL Configuration Banner -->
  <div class="config-banner" id="configBanner" style="display: none;">
    <div class="config-banner-content">
      <div class="config-banner-icon">
        <i data-lucide="info"></i>
      </div>
      <div class="config-banner-text">
        <div class="config-banner-title">Canvas URL Not Configured</div>
        <div class="config-banner-message">Configure your Canvas instance URL to start using CanvasFlow</div>
      </div>
      <button class="config-banner-btn" id="openConfigSettings">
        Configure Now
      </button>
      <button class="config-banner-close" id="closeConfigBanner" title="Dismiss">
        <i data-lucide="x"></i>
      </button>
    </div>
  </div>

  <!-- Canvas Data Tab -->
  <div class="tab-content active" id="canvas-data">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card overdue" data-filter="overdue">
        <div class="summary-value" id="overdueCount">-</div>
        <div class="summary-label">Overdue</div>
      </div>
      <div class="summary-card due-today" data-filter="due-today">
        <div class="summary-value" id="dueTodayCount">-</div>
        <div class="summary-label">Due Today</div>
      </div>
      <div class="summary-card upcoming" data-filter="upcoming">
        <div class="summary-value" id="upcomingCount">-</div>
        <div class="summary-label">Upcoming</div>
      </div>
    </div>

    <div class="assignments-section">
      <div class="section-header">
        <span id="assignmentsSectionTitle" style="display: flex; align-items: center; gap: 8px;">
          <i id="assignmentsSectionIcon" data-lucide="clock" style="width: 18px; height: 18px;"></i>
          <span id="assignmentsSectionText">Due Today</span>
        </span>
        <button id="toggleGradesBtn" class="btn-icon" title="Toggle grade visibility" style="padding: 6px; background: transparent; border: 1px solid #E5E7EB; border-radius: 6px;">
          <i id="gradesEyeIcon" data-lucide="eye-off" style="width: 16px; height: 16px; color: #6B7280;"></i>
        </button>
      </div>
      <div id="assignmentsList">
        <div class="loading">
          <span class="spinner"></span>
          Loading assignments...
        </div>
      </div>
    </div>
  </div>

  <!-- AI Dashboard Tab -->
  <div class="tab-content" id="ai-dashboard">
    <!-- View Toggle Tabs -->
    <div style="display: flex; gap: 8px; margin-bottom: 16px; background: #F3F4F6; padding: 4px; border-radius: 8px;">
      <button class="ai-view-tab active" data-view="list" style="flex: 1; padding: 8px 12px; background: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; color: #111827; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;">
        <i data-lucide="list" style="width: 16px; height: 16px;"></i>
        <span>List View</span>
      </button>
      <button class="ai-view-tab" data-view="calendar" style="flex: 1; padding: 8px 12px; background: transparent; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; color: #6B7280; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;">
        <i data-lucide="calendar" style="width: 16px; height: 16px;"></i>
        <span>Calendar View</span>
      </button>
    </div>

    <!-- List View Content -->
    <div class="ai-view-content" id="listViewContent">
      <!-- Header Card (matching calendar view) -->
      <div style="background: white; padding: 16px; border-radius: 12px; border: 1px solid #E5E7EB; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="background: linear-gradient(135deg, #1e3a5f 0%, #2c4f7c 100%); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <i data-lucide="sparkles" style="width: 20px; height: 20px; color: white;"></i>
          </div>
          <div style="flex: 1;">
            <h3 style="margin: 0; color: #111827; font-size: 15px; font-weight: 600;">Insights</h3>
            <p style="margin: 2px 0 0 0; font-size: 12px; color: #6B7280;">Flow to that A+ with smart recommendations</p>
          </div>
          <button class="btn-icon" id="generateInsightsBtn" title="Refresh insights" style="padding: 8px; background: #F3F4F6; border: 1px solid #E5E7EB; border-radius: 8px;">
            <i data-lucide="refresh-cw" style="width: 16px; height: 16px; color: #374151;"></i>
          </button>
        </div>
      </div>

      <!-- Insights Content -->
      <div id="insightsContent">
        <div class="insights-placeholder">
          <i data-lucide="sparkles" style="width: 48px; height: 48px;"></i>
          <p style="margin-bottom: 16px;">Your AI-powered insights will appear here</p>
          <p class="insights-placeholder-note" style="margin-top: 12px; font-size: 13px; color: #6B7280; line-height: 1.5;">Get priority recommendations and a personalized study plan to help you focus on what matters most</p>
        </div>
      </div>
    </div>

    <!-- Calendar View Content -->
    <div class="ai-view-content" id="calendarViewContent" style="display: none;">
      <!-- Header Card (matching schedule.html) -->
      <div style="background: white; padding: 16px; border-radius: 12px; border: 1px solid #E5E7EB; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="background: linear-gradient(135deg, #1e3a5f 0%, #2c4f7c 100%); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <i data-lucide="calendar" style="width: 20px; height: 20px; color: white;"></i>
          </div>
          <div style="flex: 1;">
            <h3 style="margin: 0; color: #111827; font-size: 15px; font-weight: 600;">This Week's Schedule</h3>
            <p style="margin: 2px 0 0 0; font-size: 12px; color: #6B7280;">Stay in the flow - master your deadlines!</p>
          </div>
          <button class="btn-icon" id="generateScheduleBtn" title="Refresh schedule" style="padding: 8px; background: #F3F4F6; border: 1px solid #E5E7EB; border-radius: 8px;">
            <i data-lucide="refresh-cw" style="width: 16px; height: 16px; color: #374151;"></i>
          </button>
        </div>
      </div>

      <!-- Schedule Content -->
      <div id="scheduleContent">
        <div class="insights-placeholder">
          <i data-lucide="calendar" style="width: 48px; height: 48px;"></i>
          <p style="margin-bottom: 16px;">Your AI-powered weekly study schedule will appear here</p>
          <p class="insights-placeholder-note" style="margin-top: 12px; font-size: 13px; color: #6B7280; line-height: 1.5;">Get a personalized day-by-day breakdown of when to work on each assignment</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Settings</h2>
        <button class="modal-close" id="closeSettingsModal">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- Canvas URL Card -->
        <div class="settings-card">
          <div class="settings-card-title">Canvas Instance</div>
          <input type="text" class="canvas-url-input" id="canvasUrlInput" placeholder="https://canvas.university.edu">
          <div class="canvas-url-buttons">
            <button class="secondary small" id="saveCanvasUrl">Save</button>
            <button class="ghost small" id="autoDetectUrl">Auto-Detect</button>
          </div>
          <div class="status-message" id="canvasUrlStatus"></div>
        </div>

        <!-- GitHub Token Card -->
        <div class="settings-card">
          <div class="settings-card-title">GitHub Models API Token</div>
          <p style="font-size: 12px; color: #6B7280; margin: 0 0 12px 0;">
            Required for AI-powered insights and schedules. Get a free token from <a href="https://github.com/marketplace/models" target="_blank" style="color: #1e3a5f;">GitHub Models</a>.
          </p>
          <input type="password" class="canvas-url-input" id="githubTokenInput" placeholder="ghp_xxxxxxxxxxxx">
          <div class="canvas-url-buttons">
            <button class="secondary small" id="saveGithubToken">Save Token</button>
            <button class="ghost small" id="clearGithubToken">Clear</button>
          </div>
          <div class="status-message" id="githubTokenStatus"></div>
        </div>

        <!-- Time Range Card -->
        <div class="settings-card">
          <div class="settings-card-title">Assignment Time Range</div>
          <p style="font-size: 12px; color: #6B7280; margin: 0 0 12px 0;">
            Control the time window for which assignments are displayed
          </p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
              <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Weeks Before</label>
              <input type="number" id="assignmentWeeksBefore" min="0" max="52" value="0" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
            </div>
            <div>
              <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Weeks After</label>
              <input type="number" id="assignmentWeeksAfter" min="1" max="52" value="2" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
            </div>
          </div>
          <div style="display: flex; gap: 8px; margin-top: 12px;">
            <button id="saveTimeRange" style="flex: 1; padding: 8px 16px; background: #1e3a5f; color: white; border: none; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 500;">
              Save Time Range
            </button>
            <button id="resetTimeRange" style="padding: 8px 16px; background: #F3F4F6; color: #374151; border: 1px solid #E5E7EB; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 500;">
              Reset
            </button>
          </div>
          <div class="status-message" id="timeRangeStatus"></div>
        </div>

        <!-- Auto-Refresh Card -->
        <div class="settings-card">
          <div class="settings-card-title">Auto-Refresh</div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1;">
              <input type="checkbox" id="autoRefreshToggle" style="cursor: pointer;">
              <span style="font-size: 13px; color: #374151;">Automatically refresh data every 30 minutes</span>
            </label>
          </div>
        </div>

        <!-- Notifications Card -->
        <div class="settings-card">
          <div class="settings-card-title">Notifications</div>
          <p style="font-size: 12px; color: #6B7280; margin: 0 0 12px 0;">
            Get reminders about upcoming deadlines
          </p>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1;">
                <input type="checkbox" id="notificationsEnabled" style="cursor: pointer;">
                <span style="font-size: 13px; color: #374151;">Enable deadline notifications</span>
              </label>
              <button id="testNotification" style="padding: 6px 12px; background: #F3F4F6; color: #374151; border: 1px solid #E5E7EB; border-radius: 6px; font-size: 12px; cursor: pointer; font-weight: 500;">
                Test Notification
              </button>
            </div>
            <div id="notificationSettings" style="display: none; padding-left: 32px; border-left: 2px solid #E5E7EB;">
              <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Notification Frequency</label>
                <select id="notificationFrequency" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px; background: white; cursor: pointer;">
                  <option value="minimal">Minimal - Only overdue</option>
                  <option value="balanced" selected>Balanced - Daily summary</option>
                  <option value="aggressive">Aggressive - All deadlines</option>
                </select>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div>
                  <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Quiet Hours Start</label>
                  <input type="time" id="quietHoursStart" value="22:00" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
                </div>
                <div>
                  <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Quiet Hours End</label>
                  <input type="time" id="quietHoursEnd" value="08:00" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="lib/lucide.min.js"></script>
  <script src="lib/lucide-init.js"></script>
  <!-- Structured Outputs Support -->
  <script src="lib/ai-schemas-sidepanel.js"></script>
  <script src="lib/ai-schemas-dashboard.js"></script>
  <script src="lib/ai-mappers.js"></script>
  <script src="lib/ai-router.js"></script>
  <script src="lib/claude-client.js"></script>
  <script src="sidepanel.js"></script>
</body>
</html>
